
/*
 * LEARNINGS
 * TO MAKE A BIT ZERO  ------> &= ~(0x3 << (5*2));
 *
 */


#include "stm32f446rxx.h"
#include <stdint.h>
#include <stdio.h>
#include <stddef.h>



uint32_t ADC1_Read(void);
float LM35_ReadTemp(void);
void SWV_Print(char *msg);





uint32_t ADC1_Read(void)
{
    ADC1->CR2 |= (1 << 30);          // SWSTART
    while(!(ADC1->SR & (1 << 1)));   // Wait for EOC
    return ADC1->DR;                 // Return data = voltage
}


float LM35_ReadTemp(void)
{
    uint32_t adc = ADC1_Read();
    float voltage_mv = (adc * 3300.0f) / 4095.0f;
    return voltage_mv / 10.0f; 						// LM35 = 10mV per 1°C
}




int main(void)
{
    GPIOA_CLK_EN();     // Enable GPIOA clock
    ADC1_CLK_EN();      // Enable ADC1 clock
    // PA1 as ANALOG
    GPIOA->MODER &= ~(0x3 << (1*2));
    GPIOA->MODER |=  (0x3 << (1*2));   // 11 = Analog mode
  // Configure ADC1
    ADC1->CR2 = 0;
        ADC1->SQR3 = 1;           // Channel 1
        ADC1->SMPR2 |= (7 << 3);  // 480 cycles sample time
        ADC1->CR2 |= (1 << 0);    // ADON enable

    while(1)
    {

        float temp = LM35_ReadTemp();

        printf("%f",temp);

        //char msg[50];
        //int t = (int)(temp * 100);   // convert 27.56 → 2756

        //sprintf(msg, "Temperature : %d.%02d C\n", t/100, t%100);
       // printf("%s", msg);
        //for(int i = 0 ; i < 100000; i++); // small delay
    }
}


